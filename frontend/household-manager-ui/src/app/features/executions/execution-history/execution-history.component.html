<div>
  <!-- Loading State -->
  @if (isLoading) {
    <div class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }

  <!-- Error State -->
  @else if (error) {
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
    </div>
  }

  <!-- Empty State -->
  @else if (executions.length === 0) {
    <div class="text-center py-4 text-muted">
      <i class="fas fa-history fa-2x mb-2"></i>
      <p class="mb-0">No execution history found</p>
    </div>
  }

  <!-- Execution List -->
  @else {
    <div class="list-group list-group-flush">
      @for (execution of executions; track execution.id) {
        <div class="list-group-item">
          <div class="d-flex align-items-start">
            <!-- Photo Thumbnail -->
            @if (execution.photoUrl) {
              <img [src]="execution.photoUrl" 
                   alt="Execution photo"
                   class="execution-photo-thumbnail rounded me-3"
                   style="width: 80px; height: 80px; object-fit: cover;">
            } @else {
              <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center"
                   style="width: 80px; height: 80px; min-width: 80px;">
                <i class="fas fa-check-circle fa-2x text-success"></i>
              </div>
            }

            <!-- Execution Details -->
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h6 class="mb-1">
                    @if (!taskId) {
                      <strong>{{ execution.taskTitle }}</strong>
                      <span class="text-muted">in {{ execution.roomName }}</span>
                    } @else {
                      {{ execution.userName }}
                    }
                  </h6>
                  @if (!taskId) {
                    <small class="text-muted d-block">Completed by {{ execution.userName }}</small>
                  }
                </div>
                <div class="text-end">
                  <small class="text-muted d-block">{{ execution.timeAgo }}</small>
                  <small class="text-muted d-block">
                    <i class="fas fa-calendar me-1"></i>
                    {{ execution.completedAt | utcDate:'short' }}
                  </small>
                </div>
              </div>

              @if (execution.notes) {
                <p class="mb-0 text-muted small">
                  <i class="fas fa-comment me-1"></i>
                  {{ execution.notes }}
                </p>
              }

              <!-- Delete button (only for full history page) -->
              @if (!limit) {
                <div class="mt-2">
                  <button type="button" 
                          class="btn btn-sm btn-outline-danger"
                          (click)="deleteExecution(execution)">
                    <i class="fas fa-trash me-1"></i>Delete
                  </button>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Pagination (only if not limited) -->
    @if (!limit && pagedResult && pagedResult.totalPages > 1) {
      <nav class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="!pagedResult.hasPreviousPage">
            <button class="page-link" (click)="onPageChange(pagedResult.pageNumber - 1)">
              Previous
            </button>
          </li>
          @for (page of [].constructor(pagedResult.totalPages); track $index) {
            <li class="page-item" [class.active]="pagedResult.pageNumber === $index + 1">
              <button class="page-link" (click)="onPageChange($index + 1)">
                {{ $index + 1 }}
              </button>
            </li>
          }
          <li class="page-item" [class.disabled]="!pagedResult.hasNextPage">
            <button class="page-link" (click)="onPageChange(pagedResult.pageNumber + 1)">
              Next
            </button>
          </li>
        </ul>
      </nav>
    }
  }
</div>